<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>NvdCve12Handler.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Dependency-Check Build-Reporting</a> &gt; <a href="../index.html" class="el_bundle">dependency-check-core</a> &gt; <a href="index.source.html" class="el_package">org.owasp.dependencycheck.data.update.nvd</a> &gt; <span class="el_source">NvdCve12Handler.java</span></div><h1>NvdCve12Handler.java</h1><pre class="source lang-java linenums">/*
 * This file is part of dependency-check-core.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Copyright (c) 2012 Jeremy Long. All Rights Reserved.
 */
package org.owasp.dependencycheck.data.update.nvd;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import javax.annotation.concurrent.NotThreadSafe;
import org.owasp.dependencycheck.dependency.VulnerableSoftware;
import org.xml.sax.Attributes;
import org.xml.sax.SAXException;
import org.xml.sax.SAXNotSupportedException;
import org.xml.sax.helpers.DefaultHandler;

/**
 * A SAX Handler that will parse the NVD CVE XML (schema version 1.2). This parses the xml and retrieves a listing of
 * CPEs that have previous versions specified. The previous version information is not in the 2.0 version of the schema
 * and is useful to ensure accurate identification (or at least complete).
 *
 * @author Jeremy Long
 */
@NotThreadSafe
<span class="fc" id="L39">public class NvdCve12Handler extends DefaultHandler {</span>

    /**
     * the supported schema version.
     */
    private static final String CURRENT_SCHEMA_VERSION = &quot;1.2&quot;;
    /**
     * the current vulnerability.
     */
    private String vulnerability;
    /**
     * a list of vulnerable software.
     */
    private List&lt;VulnerableSoftware&gt; software;
    /**
     * the vendor name.
     */
    private String vendor;
    /**
     * the product name.
     */
    private String product;
    /**
     * if the nvd cve should be skipped because it was rejected.
     */
<span class="fc" id="L64">    private boolean skip = false;</span>
    /**
     * flag indicating if there is a previous version.
     */
<span class="fc" id="L68">    private boolean hasPreviousVersion = false;</span>
    /**
     * The current element.
     */
<span class="fc" id="L72">    private final Element current = new Element();</span>
    /**
     * a map of vulnerabilities.
     */
    private Map&lt;String, List&lt;VulnerableSoftware&gt;&gt; vulnerabilities;

    /**
     * Get the value of vulnerabilities.
     *
     * @return the value of vulnerabilities
     */
    public Map&lt;String, List&lt;VulnerableSoftware&gt;&gt; getVulnerabilities() {
<span class="fc" id="L84">        return vulnerabilities;</span>
    }

    @Override
    public void startElement(String uri, String localName, String qName, Attributes attributes) throws SAXException {
<span class="fc" id="L89">        current.setNode(qName);</span>
<span class="fc bfc" id="L90" title="All 2 branches covered.">        if (current.isEntryNode()) {</span>
<span class="fc" id="L91">            vendor = null;</span>
<span class="fc" id="L92">            product = null;</span>
<span class="fc" id="L93">            hasPreviousVersion = false;</span>
<span class="fc" id="L94">            final String reject = attributes.getValue(&quot;reject&quot;);</span>
<span class="fc" id="L95">            skip = &quot;1&quot;.equals(reject);</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">            if (!skip) {</span>
<span class="fc" id="L97">                vulnerability = attributes.getValue(&quot;name&quot;);</span>
<span class="fc" id="L98">                software = new ArrayList&lt;&gt;();</span>
            } else {
<span class="fc" id="L100">                vulnerability = null;</span>
<span class="fc" id="L101">                software = null;</span>
            }
<span class="fc bfc" id="L103" title="All 4 branches covered.">        } else if (!skip &amp;&amp; current.isProdNode()) {</span>
<span class="fc" id="L104">            vendor = attributes.getValue(&quot;vendor&quot;);</span>
<span class="fc" id="L105">            product = attributes.getValue(&quot;name&quot;);</span>
<span class="fc bfc" id="L106" title="All 4 branches covered.">        } else if (!skip &amp;&amp; current.isVersNode()) {</span>
<span class="fc" id="L107">            final String prev = attributes.getValue(&quot;prev&quot;);</span>
<span class="pc bpc" id="L108" title="1 of 4 branches missed.">            if (prev != null &amp;&amp; &quot;1&quot;.equals(prev)) {</span>
<span class="fc" id="L109">                hasPreviousVersion = true;</span>
<span class="fc" id="L110">                final String edition = attributes.getValue(&quot;edition&quot;);</span>
<span class="fc" id="L111">                final String num = attributes.getValue(&quot;num&quot;);</span>

                /*yes yes, this may not actually be an &quot;a&quot; - it could be an OS, etc. but for our
                 purposes this is good enough as we won't use this if we don't find a corresponding &quot;a&quot;
                 in the nvd cve 2.0. */
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">                final int cpeLen = 8 + vendor.length() + product.length()</span>
<span class="pc bfc" id="L117" title="All 2 branches covered.">                    + (null != num ? (1 + num.length()) : 0)</span>
<span class="fc" id="L118">                    + (null != edition ? (1 + edition.length()) : 0);</span>
<span class="fc" id="L119">                final StringBuilder cpe = new StringBuilder(cpeLen);</span>
<span class="fc" id="L120">                cpe.append(&quot;cpe:/a:&quot;).append(vendor).append(':').append(product);</span>
<span class="pc bpc" id="L121" title="1 of 2 branches missed.">                if (num != null) {</span>
<span class="fc" id="L122">                    cpe.append(':').append(num);</span>
                }
<span class="fc bfc" id="L124" title="All 2 branches covered.">                if (edition != null) {</span>
<span class="fc" id="L125">                    cpe.append(':').append(edition);</span>
                }
<span class="fc" id="L127">                final VulnerableSoftware vs = new VulnerableSoftware();</span>
<span class="fc" id="L128">                vs.setCpe(cpe.toString());</span>
<span class="fc" id="L129">                vs.setPreviousVersion(prev);</span>
<span class="fc" id="L130">                software.add(vs);</span>
            }
<span class="fc bfc" id="L132" title="All 2 branches covered.">        } else if (current.isNVDNode()) {</span>
<span class="fc" id="L133">            final String nvdVer = attributes.getValue(&quot;nvd_xml_version&quot;);</span>
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">            if (!CURRENT_SCHEMA_VERSION.equals(nvdVer)) {</span>
<span class="nc" id="L135">                throw new SAXNotSupportedException(&quot;Schema version &quot; + nvdVer + &quot; is not supported&quot;);</span>
            }
<span class="fc" id="L137">            vulnerabilities = new HashMap&lt;&gt;();</span>
        }
<span class="fc" id="L139">    }</span>

    @Override
    public void endElement(String uri, String localName, String qName) throws SAXException {
<span class="fc" id="L143">        current.setNode(qName);</span>
<span class="fc bfc" id="L144" title="All 2 branches covered.">        if (current.isEntryNode()) {</span>
<span class="fc bfc" id="L145" title="All 4 branches covered.">            if (!skip &amp;&amp; hasPreviousVersion) {</span>
<span class="fc" id="L146">                vulnerabilities.put(vulnerability, software);</span>
            }
<span class="fc" id="L148">            vulnerability = null;</span>
<span class="fc" id="L149">            software = null;</span>
        }
<span class="fc" id="L151">    }</span>

    // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot;The Element Class that maintains state information about the current node&quot;&gt;
    /**
     * A simple class to maintain information about the current element while parsing the NVD CVE XML.
     */
<span class="fc" id="L157">    protected static class Element {</span>

        /**
         * A node type in the NVD CVE Schema 1.2.
         */
        public static final String NVD = &quot;nvd&quot;;
        /**
         * A node type in the NVD CVE Schema 1.2.
         */
        public static final String ENTRY = &quot;entry&quot;;
        /**
         * A node type in the NVD CVE Schema 1.2.
         */
        public static final String VULN_SOFTWARE = &quot;vuln_soft&quot;;
        /**
         * A node type in the NVD CVE Schema 1.2.
         */
        public static final String PROD = &quot;prod&quot;;
        /**
         * A node type in the NVD CVE Schema 1.2.
         */
        public static final String VERS = &quot;vers&quot;;
        /**
         * The name of the current node.
         */
        private String node;

        /**
         * Gets the value of node.
         *
         * @return the value of node
         */
        public String getNode() {
<span class="nc" id="L190">            return this.node;</span>
        }

        /**
         * Sets the value of node.
         *
         * @param node new value of node
         */
        public void setNode(String node) {
<span class="fc" id="L199">            this.node = node;</span>
<span class="fc" id="L200">        }</span>

        /**
         * Checks if the handler is at the NVD node.
         *
         * @return true or false
         */
        public boolean isNVDNode() {
<span class="fc" id="L208">            return NVD.equals(node);</span>
        }

        /**
         * Checks if the handler is at the ENTRY node.
         *
         * @return true or false
         */
        public boolean isEntryNode() {
<span class="fc" id="L217">            return ENTRY.equals(node);</span>
        }

        /**
         * Checks if the handler is at the VULN_SOFTWARE node.
         *
         * @return true or false
         */
        public boolean isVulnSoftwareNode() {
<span class="nc" id="L226">            return VULN_SOFTWARE.equals(node);</span>
        }

        /**
         * Checks if the handler is at the PROD node.
         *
         * @return true or false
         */
        public boolean isProdNode() {
<span class="fc" id="L235">            return PROD.equals(node);</span>
        }

        /**
         * Checks if the handler is at the VERS node.
         *
         * @return true or false
         */
        public boolean isVersNode() {
<span class="fc" id="L244">            return VERS.equals(node);</span>
        }
    }
    // &lt;/editor-fold&gt;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>